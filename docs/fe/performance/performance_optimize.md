# 性能优化专项学习

## 性能优化概述

开发困扰：

1. 对页面性能不够重视，导致用户体验不佳，出现崩溃、卡顿、白屏问题。
2. 不懂怎么分析页面性能瓶颈，无法进行针对性优化。
3. 不理解优化的原理，只能照搬资料，优化效果不佳，甚至是反效果。

性能优化对用户体验非常重要，对转化率提升具有重要意义，对业务提升具有重要价值，特别是低端机型。

系统掌握前端性能优化，为自己个人增值，提升自己开发页面的性能体验，提升自己负责业务的业务量。

## 性能指标

### 性能指标概述

性能是用户在页面加载和运行时的直观体验（感觉），但我们优化的时候，不能用感觉去衡量性能怎么样，必须要用可衡量的值去判断性能优化结果，这就是性能的指标。了解性能指标，可以给优化过程制定明确目标。

常见性能指标如下：

- 首屏时间（最常用）：页面以多快的速度加载和渲染元素到页面上。

- 加载后的响应时间：页面加载和执行 JS 代码后多久能响应用户交互。

- 视觉稳定时间：页面什么时候变稳定，变得不影响观看交互。

![性能指标](./images/性能指标.png)

### 首屏时间

首屏时间最大程度决定了网页的用户体验，是性能中最关注的部分，首屏时间使用哪个指标衡量，目前没有固定的标准。

目前首屏时间常用的指标主要有 FMP 和 LCP。

|指标|含义|问题|
|--|--|--|
|FP:First Paint，首次绘制|白屏时间，它代表浏览器第一次向屏幕传输像素的时间，也就是页面在屏幕上首次发生视觉变化的时间|像素的改变不够直观，代表首屏时间过于单薄，不是用户关注的内容|
|FCP:First Contentful Paint，首次内容绘制|测量页面从开始加载到页面内容的任何部分在屏幕上完成渲染的时间|内容仅包括文本、图像（包括背景图像）、svg 元素或非白色的 canvas 元素，不一定是用户关注的真正内容。背景、loading|
|LCP:Largest Contentful Paint，最大内容绘制|测量页面开始加载到最大文本块内容或图片显示在页面中的时间|存在兼容性问题，低版本安卓和IOS不支持|
|FMP:First Meaningful Paint，首次有意义绘制|首次有意义的绘制，是页面主要内容出现在屏幕上的时间|什么是主要内容？目前尚无标准化的定义|
|DOMContentLoaded|当初始的 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，而无需等待样式表、图像和子框架的完全加载|SPA 页面，index.html 加载完成后，DOMContentLoaded 即被触，但页面空白|
|OnLoad|当整个页面及所有依赖资源如样式表和图片都已完成加载时，将触发load事件|SPA 页面，index.html 加载完成后，OnLoad即被触发，但页面空白|

### 优化目标

性能指标目标：FMP或者LCP 指标在 P95 分位上达到 3.5S。也就是前 95% 的用户首屏时间需要在 3.5S 内。

从 2 个维度进行提升：

- 「真的快」：可以客观衡量的指标，像首屏时间、网页访问时间、交互响应时间、跳转页面时间。
- 「觉得快」：用户主观感知的性能，通过视觉引导等手段转移用户对等待时间的关注。

